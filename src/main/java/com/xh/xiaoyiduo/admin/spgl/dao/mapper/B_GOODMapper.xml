<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.xh.xiaoyiduo.admin.spgl.dao.B_GOODMapper" >
  <resultMap id="BaseResultMap" type="com.xh.xiaoyiduo.admin.spgl.pojo.B_GOOD" >
    <id column="GOOD_ID" property="goodId" jdbcType="VARCHAR" />
    <result column="SON_ID" property="sonId" jdbcType="VARCHAR" />
    <result column="GOOD_NAME" property="goodName" jdbcType="VARCHAR" />
    <result column="INFORMATION" property="information" jdbcType="VARCHAR" />
    <result column="ORIGIN_PRICE" property="originPrice" jdbcType="FLOAT" />
    <result column="SECOND_PRICE" property="secondPrice" jdbcType="FLOAT" />
    <result column="DEGREE" property="degree" jdbcType="VARCHAR" />
    <result column="COLLECT_NUMBER" property="collectNumber" jdbcType="DECIMAL" />
    <result column="GOOD_NUMBER" property="goodNumber" jdbcType="DECIMAL" />
    <result column="STATUS" property="status" jdbcType="VARCHAR" />
    <result column="USER_ID" property="userId" jdbcType="VARCHAR" />
  </resultMap>

  <resultMap id="GoodMap" type="com.xh.xiaoyiduo.admin.spgl.pojo.B_GOOD" >
    <id column="GOOD_ID" property="goodId" jdbcType="VARCHAR" />
    <result column="SON_ID" property="sonId" jdbcType="VARCHAR" />
    <result column="GOOD_NAME" property="goodName" jdbcType="VARCHAR" />
    <result column="INFORMATION" property="information" jdbcType="VARCHAR" />
    <result column="ORIGIN_PRICE" property="originPrice" jdbcType="FLOAT" />
    <result column="SECOND_PRICE" property="secondPrice" jdbcType="FLOAT" />
    <result column="DEGREE" property="degree" jdbcType="VARCHAR" />
    <result column="COLLECT_NUMBER" property="collectNumber" jdbcType="DECIMAL" />
    <result column="GOOD_NUMBER" property="goodNumber" jdbcType="DECIMAL" />
    <result column="STATUS" property="status" jdbcType="VARCHAR" />
    <result column="USER_ID" property="userId" jdbcType="VARCHAR" />
    <collection property="imgUrlResource" ofType="com.xh.xiaoyiduo.admin.spgl.pojo.RESOURCES">
      <id column="RESOURCE_ID" property="resourceId"></id>
      <result column="TYPE" property="type"/>
      <result column="URL" property="url"/>
      <result column="SOURCE_ID" property="sourceId"/>
    </collection>
  </resultMap>

  <sql id="Base_Column_List" >
    GOOD_ID, SON_ID, GOOD_NAME, INFORMATION, ORIGIN_PRICE, SECOND_PRICE, DEGREE, COLLECT_NUMBER, 
    GOOD_NUMBER, STATUS, USER_ID
  </sql>
  <!--获取对应子类商品列表-->
  <select id="getSonGoodList" resultMap="GoodMap" parameterType="java.lang.String" >
    <!--select-->
    <!--<include refid="Base_Column_List" />-->
    <!--from B_GOOD-->
    <!--where SON_ID = #{sonId,jdbcType=VARCHAR}-->
    select t.*, r.* from (SELECT *
    FROM (SELECT r.*,ROWNUM rn
    FROM(
    select b.* from B_GOOD b where son_id = #{sonId,jdbcType=VARCHAR}
    ) r
    where ROWNUM &lt;= #{pageSize} * #{currentPage}
    ) WHERE rn > #{pageSize} * ( #{currentPage} - 1)) t left join RESOURCES r on t.good_id = r.source_id
  </select>

  <!--获取子类商品个数-->
  <select id="getSonGoodCount" resultType="java.lang.Integer" parameterType="java.lang.String" >
    select sum(1)
    from B_GOOD b
    where b.son_id = #{SON_ID,jdbcType=VARCHAR}
  </select>

  <!--获取商品详情信息-->
  <select id="getGoodDetailByGoodId" resultMap="GoodMap" parameterType="java.lang.String" >
    select b.*, r.*
    from B_GOOD b
    left join RESOURCES r on b.good_id = r.source_id
    where good_id = #{goodId,jdbcType=VARCHAR}
  </select>

  <select id="selectByPrimaryKey" resultMap="BaseResultMap" parameterType="java.lang.String" >
    select 
    <include refid="Base_Column_List" />
    from B_GOOD
    where GOOD_ID = #{goodId,jdbcType=VARCHAR}
  </select>
  <delete id="deleteByPrimaryKey" parameterType="java.lang.String" >
    delete from B_GOOD
    where GOOD_ID = #{goodId,jdbcType=VARCHAR}
  </delete>
  <insert id="insert" parameterType="com.xh.xiaoyiduo.admin.spgl.pojo.B_GOOD" >
    insert into B_GOOD (GOOD_ID, SON_ID, GOOD_NAME, 
      INFORMATION, ORIGIN_PRICE, SECOND_PRICE, 
      DEGREE, COLLECT_NUMBER, GOOD_NUMBER, 
      STATUS, USER_ID)
    values (#{goodId,jdbcType=VARCHAR}, #{sonId,jdbcType=VARCHAR}, #{goodName,jdbcType=VARCHAR}, 
      #{information,jdbcType=VARCHAR}, #{originPrice,jdbcType=FLOAT}, #{secondPrice,jdbcType=FLOAT}, 
      #{degree,jdbcType=VARCHAR}, #{collectNumber,jdbcType=DECIMAL}, #{goodNumber,jdbcType=DECIMAL}, 
      #{status,jdbcType=VARCHAR}, #{userId,jdbcType=VARCHAR})
  </insert>
  <insert id="insertSelective" parameterType="com.xh.xiaoyiduo.admin.spgl.pojo.B_GOOD" >
    insert into B_GOOD
    <trim prefix="(" suffix=")" suffixOverrides="," >
      <if test="goodId != null" >
        GOOD_ID,
      </if>
      <if test="sonId != null" >
        SON_ID,
      </if>
      <if test="goodName != null" >
        GOOD_NAME,
      </if>
      <if test="information != null" >
        INFORMATION,
      </if>
      <if test="originPrice != null" >
        ORIGIN_PRICE,
      </if>
      <if test="secondPrice != null" >
        SECOND_PRICE,
      </if>
      <if test="degree != null" >
        DEGREE,
      </if>
      <if test="collectNumber != null" >
        COLLECT_NUMBER,
      </if>
      <if test="goodNumber != null" >
        GOOD_NUMBER,
      </if>
      <if test="status != null" >
        STATUS,
      </if>
      <if test="userId != null" >
        USER_ID,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides="," >
      <if test="goodId != null" >
        #{goodId,jdbcType=VARCHAR},
      </if>
      <if test="sonId != null" >
        #{sonId,jdbcType=VARCHAR},
      </if>
      <if test="goodName != null" >
        #{goodName,jdbcType=VARCHAR},
      </if>
      <if test="information != null" >
        #{information,jdbcType=VARCHAR},
      </if>
      <if test="originPrice != null" >
        #{originPrice,jdbcType=FLOAT},
      </if>
      <if test="secondPrice != null" >
        #{secondPrice,jdbcType=FLOAT},
      </if>
      <if test="degree != null" >
        #{degree,jdbcType=VARCHAR},
      </if>
      <if test="collectNumber != null" >
        #{collectNumber,jdbcType=DECIMAL},
      </if>
      <if test="goodNumber != null" >
        #{goodNumber,jdbcType=DECIMAL},
      </if>
      <if test="status != null" >
        #{status,jdbcType=VARCHAR},
      </if>
      <if test="userId != null" >
        #{userId,jdbcType=VARCHAR},
      </if>
    </trim>
  </insert>
  <update id="updateByPrimaryKeySelective" parameterType="com.xh.xiaoyiduo.admin.spgl.pojo.B_GOOD" >
    update B_GOOD
    <set >
      <if test="sonId != null" >
        SON_ID = #{sonId,jdbcType=VARCHAR},
      </if>
      <if test="goodName != null" >
        GOOD_NAME = #{goodName,jdbcType=VARCHAR},
      </if>
      <if test="information != null" >
        INFORMATION = #{information,jdbcType=VARCHAR},
      </if>
      <if test="originPrice != null" >
        ORIGIN_PRICE = #{originPrice,jdbcType=FLOAT},
      </if>
      <if test="secondPrice != null" >
        SECOND_PRICE = #{secondPrice,jdbcType=FLOAT},
      </if>
      <if test="degree != null" >
        DEGREE = #{degree,jdbcType=VARCHAR},
      </if>
      <if test="collectNumber != null" >
        COLLECT_NUMBER = #{collectNumber,jdbcType=DECIMAL},
      </if>
      <if test="goodNumber != null" >
        GOOD_NUMBER = #{goodNumber,jdbcType=DECIMAL},
      </if>
      <if test="status != null" >
        STATUS = #{status,jdbcType=VARCHAR},
      </if>
      <if test="userId != null" >
        USER_ID = #{userId,jdbcType=VARCHAR},
      </if>
    </set>
    where GOOD_ID = #{goodId,jdbcType=VARCHAR}
  </update>
  <update id="updateByPrimaryKey" parameterType="com.xh.xiaoyiduo.admin.spgl.pojo.B_GOOD" >
    update B_GOOD
    set SON_ID = #{sonId,jdbcType=VARCHAR},
      GOOD_NAME = #{goodName,jdbcType=VARCHAR},
      INFORMATION = #{information,jdbcType=VARCHAR},
      ORIGIN_PRICE = #{originPrice,jdbcType=FLOAT},
      SECOND_PRICE = #{secondPrice,jdbcType=FLOAT},
      DEGREE = #{degree,jdbcType=VARCHAR},
      COLLECT_NUMBER = #{collectNumber,jdbcType=DECIMAL},
      GOOD_NUMBER = #{goodNumber,jdbcType=DECIMAL},
      STATUS = #{status,jdbcType=VARCHAR},
      USER_ID = #{userId,jdbcType=VARCHAR}
    where GOOD_ID = #{goodId,jdbcType=VARCHAR}
  </update>
  <!--保存商品图片路径到资源表-->
  <insert id="saveGoodImageUrls" parameterType="java.lang.String" >
    insert into RESOURCES (RESOURCE_ID, TYPE, URL, SOURCE_ID)
    values(#{resourceId, jdbcType=VARCHAR}, #{type, jdbcType=VARCHAR},
     #{imgUrl, jdbcType=VARCHAR}, #{sonId, jdbcType=VARCHAR})
  </insert>
</mapper>